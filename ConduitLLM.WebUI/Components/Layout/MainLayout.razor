@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using ConduitLLM.WebUI.Interfaces
@inject NavigationManager NavigationManager
@inject IInsecureModeProvider InsecureModeProvider
@inject IJSRuntime JSRuntime

<CascadingValue Value="this">
    <!-- No theme providers needed with standard Blazor -->
</CascadingValue>

@if (InsecureModeProvider.IsInsecureMode)
{
    <div class="warning-banner">
        <div class="alert alert-warning py-2">
            <div class="d-flex justify-content-center align-items-center text-error">
                <i class="fa fa-shield-alt mr-2"></i>
                <strong>Warning:</strong>&nbsp;Conduit is running in Insecure Mode. Authentication is disabled. DO NOT expose this instance publicly.
            </div>
        </div>
    </div>
}

<div class="d-flex flex-column" style="min-height: 100vh;">    
    <div class="layout flex-grow-1">
        <header class="app-bar appbar">
            <div class="app-bar-container">
                <button class="btn btn-icon" @onclick="DrawerToggle">
                    <i class="fa fa-bars"></i>
                </button>
                <h6 class="app-title ml-3">Conduit</h6>
                <div class="spacer"></div>
                <NotificationDisplay />
                <ConduitLLM.WebUI.Components.Shared.AdminApiHealthStatus />
                <CascadingAuthenticationState>
                    <AuthorizeView>
                        <Authorized>
                            <div class="text-success me-3">
                                <i class="fa fa-user-check"></i>
                                Admin
                            </div>
                            <a href="/logout" class="btn btn-icon">
                                <i class="fa fa-sign-out-alt text-error"></i>
                            </a>
                        </Authorized>
                    </AuthorizeView>
                </CascadingAuthenticationState>
                <a href="https://github.com/knnlabs/Conduit" target="_blank" class="btn btn-icon">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </header>
        
        <div class="drawer @(_drawerOpen ? "drawer-open" : "drawer-closed")">
            <NavMenu />
        </div>
        
        <main class="main-content">
            <div class="container container-xxl mt-4">
                <ConduitLLM.WebUI.Components.Shared.DeprecationWarning />
                @Body
            </div>
        </main>
    </div>
</div>

<style>
    .warning-banner {
        width: 100%;
        z-index: 1300;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
    }
    
    /* Push down app bar when banner is shown */
    .appbar {
        top: @(InsecureModeProvider.IsInsecureMode ? "36px" : "0") !important;
    }
    
    /* Layout styles */
    .layout {
        display: flex;
        flex-direction: column;
    }
    
    .app-bar {
        background-color: #1976d2;
        color: white;
        height: 64px;
        display: flex;
        align-items: center;
        padding: 0 16px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .app-bar-container {
        display: flex;
        align-items: center;
        width: 100%;
    }
    
    .app-title {
        margin: 0;
        font-size: 1.25rem;
    }
    
    .spacer {
        flex-grow: 1;
    }
    
    .drawer {
        width: 250px;
        position: fixed;
        top: @(InsecureModeProvider.IsInsecureMode ? "100px" : "64px");
        bottom: 0;
        left: 0;
        background-color: white;
        box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
        z-index: 900;
        overflow-y: auto;
        transition: transform 0.3s ease;
    }
    
    .drawer-closed {
        transform: translateX(-100%);
    }
    
    .drawer-open {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 250px;
        padding-top: @(InsecureModeProvider.IsInsecureMode ? "100px" : "64px");
        min-height: 100vh;
        transition: margin-left 0.3s ease;
    }
    
    /* When drawer is closed */
    .drawer-closed + .main-content {
        margin-left: 0;
    }
    
    @@media screen and (max-width: 768px) {
        .main-content {
            margin-left: 0;
        }
        
        .drawer {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
    }
</style>

@code {
    private bool _drawerOpen = true;

    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
}
